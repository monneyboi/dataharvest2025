<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>My Presentation</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/reveal.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/theme/white.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/highlight/monokai.css"
    />

    <style>
      .reveal .slides section {
        text-align: left;
      }

      pre.unstyled {
        box-shadow: none;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1>Finding Connections</h1>
          <p>Transform your document collection into a graph visualisation</p>
        </section>

        <section>
          <h2>Who am I?</h2>

          <ul>
            <li>Freelance IT generalist</li>
            <li>Over 15 years of building information systems</li>
            <li>Worked in journalism for the last 4 years</li>
          </ul>
        </section>

        <section>
          <h2>What we'll cover today</h2>
          <ul>
            <li>What GraphRAG is, and how it works</li>
            <li>How to get your documents ready</li>
            <li>Extracting a graph from your documents</li>
          </ul>
        </section>

        <section>
          <h2>So, what is GraphRAG?</h2>
          <p class="fragment">
            A way of getting better answers from a language model by using a
            knowledge graph
          </p>
        </section>

        <section>
          <h2>Graph + RAG</h2>
          <p class="fragment">What is a graph?</p>
          <p class="fragment">And, what is RAG?</p>
        </section>

        <section>
          <p>So first things first...</p>
        </section>

        <section>
          <div class="r-stack">
            <h2>What is a graph?</h2>
            <div class="fragment" id="graph"></div>
          </div>
        </section>

        <section>
          <p>Nodes and edges.</p>
          <p class="fragment">
            <strong>Or:</strong> Entities and their relations.
          </p>
        </section>

        <section>
          <!-- prettier-ignore -->
          <div class="mermaid">
              graph LR
                style A fill:#f9f,stroke:#333,stroke-width:2px
                style B fill:#bbf,stroke:#333,stroke-width:2px
                style C fill:#bfb,stroke:#333,stroke-width:2px
                style D fill:#fbf,stroke:#333,stroke-width:2px
                style E fill:#ffb,stroke:#333,stroke-width:2px
                style F fill:#fbb,stroke:#333,stroke-width:2px
                style G fill:#bff,stroke:#333,stroke-width:2px

                A[Company A]
                B[Company B]
                C[Person C]
                D[Person D]
                E[Transaction E]
                F[Location F]
                G[Bank G]

                A -->|owns| B
                B -->|employs| C
                B -->|employs| D
                C -->|initiated| E
                D -->|authorized| E
                E -->|processed at| G
                E -->|occurred in| F

            </div>
        </section>

        <section>
          <h2>But what is RAG?</h2>
          <p class="fragment">R(etrieval) A(ugmented) G(eneration)</p>
          <p class="fragment">
            <strong>Help the language model with relevant information</strong>
          </p>
        </section>

        <section>
          <p>
            <strong>1.</strong> Find relevant information that can be used to
            answer your question
          </p>
        </section>

        <section>
          <p>
            <strong>2.</strong> Provide the language model with the retrieved
            information alongside the question.
          </p>
        </section>

        <section>
          <p><strong>3.</strong> Get better answers.</p>
        </section>

        <section>
          <p>Sounds familiar?</p>
        </section>

        <section data-background-image="deepresearch.png"></section>

        <section>
          <h2>So, what is relevant?</h2>
          <p>What information do you give to the model?</p>
        </section>

        <section>
          <p>Deep Research searches the web</p>
          <p class="fragment">
            But GraphRAG makes use of <strong>"semantic search"</strong>
          </p>
        </section>

        <section>
          <p>
            Semantic search is a way of finding semantically similar information
          </p>
          <p class="fragment">
            It works by converting texts into numerical representations that can
            be compared, usually Vectors
          </p>
        </section>

        <section>
          <p>Don't worry, it's simpler than it sounds</p>
        </section>

        <section>
          <p>These vectors are called <strong>embeddings</strong></p>
          <p class="fragment">
            Because we're embedding text into multidimensional space
          </p>
        </section>

        <section>
          <p>
            A vector is a <strong>direction in multidimensional space</strong>
          </p>
          <p class="fragment">
            In other words, <strong>a list of numbers</strong>
          </p>
        </section>

        <section>
          <p>
            This conversion is done with
            <strong>"embedding models"</strong> that are trained specifically
            for this task.
          </p>
        </section>

        <section>
          <p>
            Let's try with
            <a
              href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2"
              >all-MiniLM-L6-v2</a
            >
          </p>
          <pre><code data-trim data-noescape class="language-python">
from sentence_transformers import SentenceTransformer

model = SentenceTransformer("sentence-transformers/all-MiniLM-L6-v2")

sentence = "The sun is shining"
embedding = model.encode(sentence)
            </code></pre>
        </section>

        <section>
          <p>"The sun is shining" becomes...</p>
        </section>

        <section>
          <pre class="unstyled">
 5.42898139e-04  1.02551401e-01  8.36703405e-02  9.39253941e-02
 2.07145736e-02 -1.12772360e-02  9.93586630e-02 -4.44610193e-02
 3.98165248e-02 -2.13668533e-02  2.09684577e-02 -3.66757251e-02
 7.11042061e-03  4.15845886e-02  1.01847239e-01  7.34366402e-02
 1.43970475e-02  4.65401914e-03  9.70691442e-03 -4.16579135e-02
-2.30006799e-02 -2.27442160e-02 -2.73266062e-02 -1.22460043e-02
-8.25940259e-03  6.72213510e-02 -2.77701933e-02  2.63383351e-02
-6.12662174e-02 -1.37788551e-02  2.81139649e-02  5.81778679e-03
... etc ... ...

384 dimensions
            </pre
          >
        </section>

        <section>
          <p>
            Great. But now that we have our numerical representation,
            <strong>how do we compare it to others?</strong>
          </p>
        </section>

        <section>
          <p>
            Embedding models are trained so that vectors with
            <strong>similar direction and magnitude</strong> are semantically
            similar
          </p>
        </section>

        <section>
          <p>
            Usually this is calculated with <strong>Cosine Similarity</strong>
          </p>
        </section>

        <section>
          <p>Let's see what that looks like</p>
          <p class="fragment">
            <strong>384 dimensions</strong> is hard to visualize though...
          </p>
          <p class="fragment">
            So let's imagine we just have <strong>2 dimensions</strong>
          </p>
        </section>

        <section>
          <div id="embedding-first"></div>
          <div class="fragment" id="embedding-second"></div>
          <div class="fragment" id="embedding-lines"></div>
          <div class="fragment" id="embedding-angle"></div>
          <div class="fragment" id="embedding-similarity"></div>
        </section>

        <section>
          <svg width="600" height="600">
            <g
              class="axis"
              transform="translate(0, 300)"
              fill="none"
              font-size="10"
              font-family="sans-serif"
              text-anchor="middle"
            >
              <path
                class="domain"
                stroke="currentColor"
                d="M10.5,6V0.5H590.5V6"
              ></path>
              <g class="tick" opacity="1" transform="translate(10.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">−1.0</text>
              </g>
              <g
                class="tick"
                opacity="1"
                transform="translate(68.49999999999999,0)"
              >
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">−0.8</text>
              </g>
              <g class="tick" opacity="1" transform="translate(126.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">−0.6</text>
              </g>
              <g class="tick" opacity="1" transform="translate(184.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">−0.4</text>
              </g>
              <g class="tick" opacity="1" transform="translate(242.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">−0.2</text>
              </g>
              <g class="tick" opacity="1" transform="translate(300.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">0.0</text>
              </g>
              <g class="tick" opacity="1" transform="translate(358.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">0.2</text>
              </g>
              <g class="tick" opacity="1" transform="translate(416.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">0.4</text>
              </g>
              <g class="tick" opacity="1" transform="translate(474.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">0.6</text>
              </g>
              <g class="tick" opacity="1" transform="translate(532.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">0.8</text>
              </g>
              <g class="tick" opacity="1" transform="translate(590.5,0)">
                <line stroke="currentColor" y2="6"></line>
                <text fill="currentColor" y="9" dy="0.71em">1.0</text>
              </g>
            </g>
            <g
              class="axis"
              transform="translate(300, 0)"
              fill="none"
              font-size="10"
              font-family="sans-serif"
              text-anchor="end"
            >
              <path
                class="domain"
                stroke="currentColor"
                d="M-6,590.5H0.5V10.5H-6"
              ></path>
              <g class="tick" opacity="1" transform="translate(0,590.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">−1.0</text>
              </g>
              <g class="tick" opacity="1" transform="translate(0,532.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">−0.8</text>
              </g>
              <g class="tick" opacity="1" transform="translate(0,474.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">−0.6</text>
              </g>
              <g class="tick" opacity="1" transform="translate(0,416.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">−0.4</text>
              </g>
              <g class="tick" opacity="1" transform="translate(0,358.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">−0.2</text>
              </g>
              <g class="tick" opacity="1" transform="translate(0,300.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">0.0</text>
              </g>
              <g class="tick" opacity="1" transform="translate(0,242.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">0.2</text>
              </g>
              <g
                class="tick"
                opacity="1"
                transform="translate(0,184.50000000000003)"
              >
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">0.4</text>
              </g>
              <g
                class="tick"
                opacity="1"
                transform="translate(0,126.49999999999997)"
              >
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">0.6</text>
              </g>
              <g
                class="tick"
                opacity="1"
                transform="translate(0,68.49999999999999)"
              >
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">0.8</text>
              </g>
              <g class="tick" opacity="1" transform="translate(0,10.5)">
                <line stroke="currentColor" x2="-6"></line>
                <text fill="currentColor" x="-9" dy="0.32em">1.0</text>
              </g>
            </g>
            <g class="fragment">
              <circle
                class="point"
                cx="343.5"
                cy="91.2"
                r="6"
                fill="#1f77b4"
              ></circle>
              <line
                x1="300"
                y1="300"
                x2="343.5"
                y2="91.2"
                stroke="#1f77b4"
                stroke-width="2"
              ></line>
              <text
                x="301.75"
                y="185.60000000000005"
                style="font-size: 1.5rem"
                fill="#1f77b4"
              >
                Vector A
              </text>
              <text x="353.5" y="81.2" style="font-size: 2rem">
                (0.15, 0.72)
              </text>
            </g>
            <g class="fragment">
              <circle
                class="point"
                cx="447.9"
                cy="175.3"
                r="6"
                fill="#ff7f0e"
              ></circle>
              <line
                x1="300"
                y1="300"
                x2="447.9"
                y2="175.3"
                stroke="#ff7f0e"
                stroke-width="2"
              ></line>
              <text
                x="383.95"
                y="227.64999999999998"
                style="font-size: 1.5rem"
                fill="#ff7f0e"
              >
                Vector B
              </text>
              <text x="457.9" y="165.3" style="font-size: 2rem">
                (0.51, 0.43)
              </text>
            </g>
            <g class="fragment">
              <path
                d="M16.316,-78.318A80,80,0,0,1,61.162,-51.568L57.339,-48.345A75,75,0,0,0,15.297,-73.424Z"
                transform="translate(300, 300)"
                fill="#2ca02c"
              ></path>
              <text
                x="368.66742960377087"
                y="381.5872618474355"
                style="font-size: 1.5rem"
                fill="#2ca02c"
                text-anchor="middle"
              >
                θ = 38.1°
              </text>
            </g>
            <g class="fragment">
              <text
                x="450"
                y="580"
                style="font-size: 2rem"
                text-anchor="middle"
                fill="#d62728"
              >
                Similarity = 0.7870
              </text>
              <text
                x="450"
                y="540"
                style="font-size: 1.8rem"
                text-anchor="middle"
              >
                cos(θ) = A·B / (|A|·|B|)
              </text>
            </g>
          </svg>
        </section>
      </div>
    </div>

    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
      import "https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/reveal.min.js";
      import "https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/highlight/highlight.js";
      import "https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js";

      mermaid.initialize({
        theme: "neutral",
        themeVariables: {
          fontSize: "3rem",
        },
      });

      async function initialize_graph() {
        const response = await fetch(
          "https://static.observableusercontent.com/files/e3680d5f766e85edde560c9c31a6dba2ddfcf2f66e1dced4afa18d8040f1f205e0bde1b8b234d866373f2bfc5806fafc47e244c5c9f48b60aaa1917c1b80fcb7?response-content-disposition=attachment%3Bfilename*%3DUTF-8%27%27graph.json",
        );

        const data = await response.json();

        // Specify the dimensions of the chart.
        const width = 700;
        const height = 700;

        // Specify the color scale.
        const color = d3.scaleOrdinal(d3.schemeCategory10);

        // The force simulation mutates links and nodes, so create a copy
        // so that re-evaluating this cell produces the same result.
        const links = data.links.map((d) => ({ ...d }));
        const nodes = data.nodes.map((d) => ({ ...d }));

        // Create the SVG container.
        const svg = d3
          .select("#graph")
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("viewBox", [-width / 2, -height / 2, width, height]);

        // Add a line for each link, and a circle for each node.
        const link = svg
          .append("g")
          .attr("stroke", "#999")
          .attr("stroke-opacity", 0.6)
          .selectAll("line")
          .data(links)
          .join("line")
          .attr("stroke-width", (d) => Math.sqrt(d.value));

        const node = svg
          .append("g")
          .attr("stroke", "#fff")
          .attr("stroke-width", 1.5)
          .selectAll("circle")
          .data(nodes)
          .join("circle")
          .attr("r", 5)
          .attr("fill", (d) => color(d.group));

        Reveal.on("fragmentshown", function (event) {
          const fragment = event.fragment;
          if (fragment.id === "graph" && !fragment.dataset.initialized) {
            // Create a simulation with several forces.
            const simulation = d3
              .forceSimulation(nodes)
              .force(
                "link",
                d3.forceLink(links).id((d) => d.id),
              )
              .force("charge", d3.forceManyBody())
              .force("x", d3.forceX())
              .force("y", d3.forceY());
            // Set the position attributes of links and nodes each time the simulation ticks.
            simulation.on("tick", () => {
              link
                .attr("x1", (d) => d.source.x)
                .attr("y1", (d) => d.source.y)
                .attr("x2", (d) => d.target.x)
                .attr("y2", (d) => d.target.y);

              node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
            });

            fragment.dataset.initialized = "true";
          }
        });
      }

      // SVG dimensions
      const width = 600;
      const height = 600;
      const margin = 10;

      // Data point
      const points = [
        { x: 0.15, y: 0.72 },
        { x: 0.51, y: 0.43 },
      ];

      // Create SVG
      const svg = d3
        .select("#embedding-first")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      // Create scales
      const xScale = d3
        .scaleLinear()
        .domain([-1, 1]) // x-axis range from -1 to 1
        .range([margin, width - margin]);

      const yScale = d3
        .scaleLinear()
        .domain([-1, 1]) // y-axis range from -1 to 1
        .range([height - margin, margin]);

      // Create axes
      const xAxis = d3.axisBottom(xScale);
      const yAxis = d3.axisLeft(yScale);

      // Add X axis
      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", `translate(0, ${yScale(0)})`)
        .call(xAxis);

      // Add Y axis
      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", `translate(${xScale(0)}, 0)`)
        .call(yAxis);

      // Add the first point
      svg
        .append("circle")
        .attr("class", "point")
        .attr("cx", xScale(points[0].x))
        .attr("cy", yScale(points[0].y))
        .attr("r", 6)
        .attr("fill", "#1f77b4");

      // Add point coordinates label
      svg
        .append("text")
        .attr("x", xScale(points[0].x) + 10)
        .attr("y", yScale(points[0].y) - 10)
        .text(`(${points[0].x}, ${points[0].y})`)
        .style("font-size", "2rem");

      Reveal.on("fragmentshown", function (event) {
        const fragment = event.fragment;
        if (
          fragment.id === "embedding-second" &&
          !fragment.dataset.initialized
        ) {
          // Add the second point
          svg
            .append("circle")
            .attr("class", "point")
            .attr("cx", xScale(points[1].x))
            .attr("cy", yScale(points[1].y))
            .attr("r", 6)
            .attr("fill", "#ff7f0e");

          // Add point coordinates label
          svg
            .append("text")
            .attr("x", xScale(points[1].x) + 10)
            .attr("y", yScale(points[1].y) - 10)
            .text(`(${points[1].x}, ${points[1].y})`)
            .style("font-size", "2rem");
          fragment.dataset.initialized = "true";
        }

        // Add lines from origin to each point (vector visualization)
        if (
          fragment.id === "embedding-lines" &&
          !fragment.dataset.initialized
        ) {
          // Line from origin to first point
          svg
            .append("line")
            .attr("x1", xScale(0))
            .attr("y1", yScale(0))
            .attr("x2", xScale(points[0].x))
            .attr("y2", yScale(points[0].y))
            .attr("stroke", "#1f77b4")
            .attr("stroke-width", 2);

          // Line from origin to second point
          svg
            .append("line")
            .attr("x1", xScale(0))
            .attr("y1", yScale(0))
            .attr("x2", xScale(points[1].x))
            .attr("y2", yScale(points[1].y))
            .attr("stroke", "#ff7f0e")
            .attr("stroke-width", 2);

          // Add vector labels
          svg
            .append("text")
            .attr("x", xScale(points[0].x / 2) - 20)
            .attr("y", yScale(points[0].y / 2) - 10)
            .text("Vector A")
            .style("font-size", "1.5rem")
            .attr("fill", "#1f77b4");

          svg
            .append("text")
            .attr("x", xScale(points[1].x / 2) + 10)
            .attr("y", yScale(points[1].y / 2) - 10)
            .text("Vector B")
            .style("font-size", "1.5rem")
            .attr("fill", "#ff7f0e");

          fragment.dataset.initialized = "true";
        }

        // Add arc showing the angle between vectors
        if (
          fragment.id === "embedding-angle" &&
          !fragment.dataset.initialized
        ) {
          // Calculate angle between vectors
          const dotProduct =
            points[0].x * points[1].x + points[0].y * points[1].y;
          const magA = Math.sqrt(
            points[0].x * points[0].x + points[0].y * points[0].y,
          );
          const magB = Math.sqrt(
            points[1].x * points[1].x + points[1].y * points[1].y,
          );
          const cosTheta = dotProduct / (magA * magB);
          const theta = Math.acos(cosTheta);

          // Angle in degrees for display
          const angleDegrees = ((theta * 180) / Math.PI).toFixed(1);

          // Create arc path between vectors
          const radius = 75;
          const arcGenerator = d3
            .arc()
            .innerRadius(radius)
            .outerRadius(radius + 5)
            .startAngle(Math.atan2(points[0].x, points[0].y))
            .endAngle(Math.atan2(points[1].x, points[1].y));

          svg
            .append("path")
            .attr("d", arcGenerator)
            .attr("transform", `translate(${xScale(0)}, ${yScale(0)})`) // FIXED: Now positioned at the origin
            .attr("fill", "#2ca02c");

          // Add angle label
          const midAngle =
            (Math.atan2(points[0].y, points[0].x) +
              Math.atan2(points[1].y, points[1].x)) /
            2;
          const labelRadius = radius + 20;

          svg
            .append("text")
            .attr("x", xScale(0) + Math.cos(midAngle) * labelRadius + 20)
            .attr("y", yScale(0) + Math.sin(midAngle) * labelRadius)
            .text(`θ = ${angleDegrees}°`)
            .style("font-size", "1.5rem")
            .attr("fill", "#2ca02c")
            .attr("text-anchor", "middle");

          fragment.dataset.initialized = "true";
        }

        // Add cosine similarity explanation
        if (
          fragment.id === "embedding-similarity" &&
          !fragment.dataset.initialized
        ) {
          // Calculate cosine similarity
          const dotProduct =
            points[0].x * points[1].x + points[0].y * points[1].y;
          const magA = Math.sqrt(
            points[0].x * points[0].x + points[0].y * points[0].y,
          );
          const magB = Math.sqrt(
            points[1].x * points[1].x + points[1].y * points[1].y,
          );
          const cosineSimilarity = dotProduct / (magA * magB);

          // Add similarity score at the right side
          svg
            .append("text")
            .attr("x", width - 150)
            .attr("y", height - 20)
            .text(`Similarity = ${cosineSimilarity.toFixed(4)}`)
            .style("font-size", "2rem")
            .attr("text-anchor", "middle")
            .attr("fill", "#d62728");

          // Add formula explanation
          svg
            .append("text")
            .attr("x", width - 150)
            .attr("y", height - 60)
            .text("cos(θ) = A·B / (|A|·|B|)")
            .style("font-size", "1.8rem")
            .attr("text-anchor", "middle");

          fragment.dataset.initialized = "true";
        }
      });

      await initialize_graph();

      Reveal.initialize({
        history: true,
        plugins: [RevealHighlight],
      });
    </script>
  </body>
</html>
