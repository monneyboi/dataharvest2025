<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>My Presentation</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/reveal.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/theme/white.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/highlight/monokai.css"
    />

    <style>
      .reveal .slides section {
        text-align: left;
      }

      pre.unstyled {
        box-shadow: none;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1>Finding Connections</h1>
          <p>Transform your document collection into a graph visualisation</p>
        </section>

        <section>
          <h2>Who am I?</h2>

          <ul>
            <li>Freelance IT generalist</li>
            <li>Over 15 years of building information systems</li>
            <li>Worked in journalism for the last 4 years</li>
          </ul>
        </section>

        <section>
          <h2>What we'll cover today</h2>
          <ul>
            <li>What GraphRAG is, and how it works</li>
            <li>How to get your documents ready</li>
            <li>Extracting a graph from your documents</li>
          </ul>
        </section>

        <section>
          <h2>So, what is GraphRAG?</h2>
          <p class="fragment">
            A way of getting better answers from a language model by using a
            knowledge graph
          </p>
        </section>

        <section>
          <h2>Graph + RAG</h2>
          <p class="fragment">What is a graph?</p>
          <p class="fragment">And, what is RAG?</p>
        </section>

        <section>
          <p>So first things first...</p>
        </section>

        <section>
          <div class="r-stack">
            <h2>What is a graph?</h2>
            <div class="fragment" id="graph"></div>
          </div>
        </section>

        <section>
          <p>Nodes and edges.</p>
          <p class="fragment">
            <strong>Or:</strong> Entities and their relations.
          </p>
        </section>

        <section>
          <!-- prettier-ignore -->
          <div class="mermaid">
              graph LR
                style A fill:#f9f,stroke:#333,stroke-width:2px
                style B fill:#bbf,stroke:#333,stroke-width:2px
                style C fill:#bfb,stroke:#333,stroke-width:2px
                style D fill:#fbf,stroke:#333,stroke-width:2px
                style E fill:#ffb,stroke:#333,stroke-width:2px
                style F fill:#fbb,stroke:#333,stroke-width:2px
                style G fill:#bff,stroke:#333,stroke-width:2px

                A[Company A]
                B[Company B]
                C[Person C]
                D[Person D]
                E[Transaction E]
                F[Location F]
                G[Bank G]

                A -->|owns| B
                B -->|employs| C
                B -->|employs| D
                C -->|initiated| E
                D -->|authorized| E
                E -->|processed at| G
                E -->|occurred in| F

            </div>
        </section>

        <section>
          <h2>But what is RAG?</h2>
          <p class="fragment">R(etrieval) A(ugmented) G(eneration)</p>
          <p class="fragment">
            Help the language model with relevant information
          </p>
        </section>

        <section>
          <p>
            <strong>1.</strong> Find relevant information that can be used to
            answer your question
          </p>
        </section>

        <section>
          <p>
            <strong>2.</strong> Provide the language model with the retrieved
            information alongside the question.
          </p>
        </section>

        <section>
          <p><strong>3.</strong> Get better answers.</p>
        </section>

        <section>
          <h2>What is relevant?</h2>
          <p>
            How does the computer know what information is relevant to the
            question?
          </p>
        </section>

        <section>
          <p>
            By converting texts into numerical representations that can be
            compared, usually Vectors
          </p>

          <p class="fragment">These are called <strong>embeddings</strong></p>
        </section>

        <section>
          <p>
            A vector is a <strong>coordinate in multidimensional space</strong>
          </p>
          <p class="fragment">
            In other words, <strong>a list of numbers</strong>
          </p>
        </section>

        <section>
          <p>
            This conversion is done with "embedding models" that are trained
            specifically for this task.
          </p>
        </section>

        <section>
          <p>
            Let's try with
            <a
              href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2"
              >all-MiniLM-L6-v2</a
            >
          </p>
          <pre><code data-trim data-noescape class="language-python">
from sentence_transformers import SentenceTransformer

model = SentenceTransformer("sentence-transformers/all-MiniLM-L6-v2")

sentence = "The sun is shining"
embedding = model.encode(sentence)
            </code></pre>
        </section>

        <section>
          <p>"The sun is shining" becomes...</p>
        </section>

        <section>
          <pre class="unstyled">
 5.42898139e-04  1.02551401e-01  8.36703405e-02  9.39253941e-02
 2.07145736e-02 -1.12772360e-02  9.93586630e-02 -4.44610193e-02
 3.98165248e-02 -2.13668533e-02  2.09684577e-02 -3.66757251e-02
 7.11042061e-03  4.15845886e-02  1.01847239e-01  7.34366402e-02
 1.43970475e-02  4.65401914e-03  9.70691442e-03 -4.16579135e-02
-2.30006799e-02 -2.27442160e-02 -2.73266062e-02 -1.22460043e-02
-8.25940259e-03  6.72213510e-02 -2.77701933e-02  2.63383351e-02
-6.12662174e-02 -1.37788551e-02  2.81139649e-02  5.81778679e-03
... etc ... ...

384 dimensions
            </pre
          >
        </section>

        <section>
          <p>
            Great. But now that we have our numerical representation,
            <strong>how do we compare it to others?</strong>
          </p>
        </section>

        <section>
          <p>First of all, that's a lot of numbers...</p>
          <p class="fragment">So let's imagine we just have 2 dimensions</p>
        </section>

        <section>
          <div id="embedding-first"></div>
          <div class="fragment" id="embedding-second"></div>
        </section>
      </div>
    </div>

    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
      import "https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/reveal.min.js";
      import "https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/highlight/highlight.js";
      import "https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js";

      mermaid.initialize({
        theme: "neutral",
        themeVariables: {
          fontSize: "3rem",
        },
      });

      async function initialize_graph() {
        const response = await fetch(
          "https://static.observableusercontent.com/files/e3680d5f766e85edde560c9c31a6dba2ddfcf2f66e1dced4afa18d8040f1f205e0bde1b8b234d866373f2bfc5806fafc47e244c5c9f48b60aaa1917c1b80fcb7?response-content-disposition=attachment%3Bfilename*%3DUTF-8%27%27graph.json",
        );

        const data = await response.json();

        // Specify the dimensions of the chart.
        const width = 700;
        const height = 700;

        // Specify the color scale.
        const color = d3.scaleOrdinal(d3.schemeCategory10);

        // The force simulation mutates links and nodes, so create a copy
        // so that re-evaluating this cell produces the same result.
        const links = data.links.map((d) => ({ ...d }));
        const nodes = data.nodes.map((d) => ({ ...d }));

        // Create the SVG container.
        const svg = d3
          .select("#graph")
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("viewBox", [-width / 2, -height / 2, width, height]);

        // Add a line for each link, and a circle for each node.
        const link = svg
          .append("g")
          .attr("stroke", "#999")
          .attr("stroke-opacity", 0.6)
          .selectAll("line")
          .data(links)
          .join("line")
          .attr("stroke-width", (d) => Math.sqrt(d.value));

        const node = svg
          .append("g")
          .attr("stroke", "#fff")
          .attr("stroke-width", 1.5)
          .selectAll("circle")
          .data(nodes)
          .join("circle")
          .attr("r", 5)
          .attr("fill", (d) => color(d.group));

        Reveal.on("fragmentshown", function (event) {
          const fragment = event.fragment;
          if (fragment.id === "graph" && !fragment.dataset.initialized) {
            // Create a simulation with several forces.
            const simulation = d3
              .forceSimulation(nodes)
              .force(
                "link",
                d3.forceLink(links).id((d) => d.id),
              )
              .force("charge", d3.forceManyBody())
              .force("x", d3.forceX())
              .force("y", d3.forceY());
            // Set the position attributes of links and nodes each time the simulation ticks.
            simulation.on("tick", () => {
              link
                .attr("x1", (d) => d.source.x)
                .attr("y1", (d) => d.source.y)
                .attr("x2", (d) => d.target.x)
                .attr("y2", (d) => d.target.y);

              node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
            });

            fragment.dataset.initialized = "true";
          }
        });
      }

      // SVG dimensions
      const width = 600;
      const height = 600;
      const margin = 10;

      // Data point
      const points = [
        { x: 0.3, y: 0.5 },
        { x: 0.2, y: 0.4 },
      ];

      // Create SVG
      const svg = d3
        .select("#embedding-first")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      // Create scales
      const xScale = d3
        .scaleLinear()
        .domain([-1, 1]) // x-axis range from -1 to 1
        .range([margin, width - margin]);

      const yScale = d3
        .scaleLinear()
        .domain([-1, 1]) // y-axis range from -1 to 1
        .range([height - margin, margin]);

      // Create axes
      const xAxis = d3.axisBottom(xScale);
      const yAxis = d3.axisLeft(yScale);

      // Add X axis
      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", `translate(0, ${yScale(0)})`)
        .call(xAxis);

      // Add Y axis
      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", `translate(${xScale(0)}, 0)`)
        .call(yAxis);

      // Add the point
      svg
        .append("circle")
        .attr("class", "point")
        .attr("cx", xScale(points[0].x))
        .attr("cy", yScale(points[0].y))
        .attr("r", 6);

      // Add point coordinates label
      svg
        .append("text")
        .attr("x", xScale(points[0].x) + 10)
        .attr("y", yScale(points[0].y) - 10)
        .text(`(${points[0].x}, ${points[0].y})`)
        .style("font-size", "2rem");

      Reveal.on("fragmentshown", function (event) {
        const fragment = event.fragment;
        if (
          fragment.id === "embedding-second" &&
          !fragment.dataset.initialized
        ) {
          // Add the point
          svg
            .append("circle")
            .attr("class", "point")
            .attr("cx", xScale(points[1].x))
            .attr("cy", yScale(points[1].y))
            .attr("r", 6);

          // Add point coordinates label
          svg
            .append("text")
            .attr("x", xScale(points[1].x) + 10)
            .attr("y", yScale(points[1].y) - 10)
            .text(`(${points[1].x}, ${points[1].y})`)
            .style("font-size", "2rem");
          fragment.dataset.initialized = "true";
        }
      });

      await initialize_graph();

      Reveal.initialize({
        history: true,
        plugins: [RevealHighlight],
      });
    </script>
  </body>
</html>
